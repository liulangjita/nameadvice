#utf-8

TianGan = "¼×ÒÒ±û¶¡Îì¼º¸ıĞÁÈÉ¹ï"
DiZhi = "×Ó³óÒúÃ®³½ËÈÎçÎ´ÉêÓÏĞçº¥"

def CheckBazi(bazi):
    baziLen = len(bazi)
    if baziLen != 6 and baziLen != 8:
        return False
    i = 0
    while i < baziLen:
        ch = bazi[i]
        for j in range(0,10):
            if ch == TianGan[j]:
                break
        if j > 10 or j==10:
            return False
        i = i+1

        ch = bazi[i]
        for j in range(0,12):
            if ch==DiZhi[j]:
                break
        if j > 12 or j==12:
            return False
        i = i+1
    return True


# ¸ù¾İ³öÉúÈÕ×ÓµÄÌì¸É£¬Í¨¹ıÏÂ±íÀ´²éËãÊ±³½¸ÉÖ§
# Ê±³½¸ÉÖ§²éËã±í
# Ê±¼äÊ±³½                             ÎåĞĞ¼ÍÈÕ¸ÉÖ§
#                         ¼×¼º     ÒÒ¸ı     ±ûĞÁ     ¶¡ÈÉ     Îì¹ï
#
# 23£­01 ×Ó/Ë®           ¼××Ó     ±û×Ó     Îì×Ó     ¸ı×Ó     ÈÉ×Ó
# 01£­03 ³ó/ÍÁ           ÒÒ³ó     ¶¡³ó     ¼º³ó     ĞÁ³ó     ¹ï³ó
# 03£­05 Òú/Ä¾           ±ûÒú     ÎìÒú     ¸ıÒú     ÈÉÒú     ¼×Òú
# 05£­07 Ã®/Ä¾           ¶¡Ã®     ¼ºÃ®     ĞÁÃ®     ¹ïÃ®     ÒÒÃ®
# 07£­09 ³½/ÍÁ           Îì³½     ¸ı³½     ÈÉ³½     ¼×³½     ±û³½
# 09£­11 ËÈ/»ğ           ¼ºËÈ     ĞÁËÈ     ¹ïËÈ     ¼ºËÈ     ¶¡ËÈ
# 11£­13 Îç/»ğ           ¸ıÎç     ÈÉÎç     ¼×Îç     ±ûÎç     ÎìÎç
# 13£­15 Î´/ÍÁ           ĞÁÎ´     ¹ïÎ´     ÒÒÎ´     ¶¡Î´     ¼ºÎ´
# 15£­17 Éê/½ğ           ÈÉÉê     ¼×Éê     ±ûÉê     ÎìÉê     ¸ıÉê
# 17£­19 ÓÏ/½ğ           ¹ïÓÏ     ÒÒÓÏ     ¶¡ÓÏ     ¼ºÓÏ     ĞÁÓÏ
# 19£­21 Îì/ÍÁ           ¼×Ğç     ±ûĞç     ÎìĞç     ¸ıĞç     ÈÉĞç
# 21£­23 º¥/Ë®           ÒÒº¥     ¶¡º¥     ¼ºº¥     ĞÁº¥     ¹ïº¥

cTimeGanZhi_Table = [
         ["¼××Ó","±û×Ó", "Îì×Ó", "¸ı×Ó", "ÈÉ×Ó"],
         ["ÒÒ³ó","¶¡³ó", "¼º³ó", "ĞÁ³ó", "¹ï³ó"],
         ["±ûÒú","ÎìÒú", "¸ıÒú", "ÈÉÒú", "¼×Òú"],
         ["¶¡Ã®","¼ºÃ®", "ĞÁÃ®", "¹ïÃ®", "ÒÒÃ®"],
         ["Îì³½","¸ı³½", "ÈÉ³½", "¼×³½", "±û³½"],
         ["¼ºËÈ","ĞÁËÈ", "¹ïËÈ", "¼ºËÈ", "¶¡ËÈ"],
         ["¸ıÎç", "ÈÉÎç","¼×Îç", "±ûÎç", "ÎìÎç"],
         ["ĞÁÎ´","¹ïÎ´", "ÒÒÎ´", "¶¡Î´", "¼ºÎ´"],
         ["ÈÉÉê","¼×Éê", "±ûÉê", "ÎìÉê", "¸ıÉê"],
         ["¹ïÓÏ","ÒÒÓÏ", "¶¡ÓÏ", "¼ºÓÏ", "ĞÁÓÏ"],
         ["¼×Ğç","±ûĞç", "ÎìĞç", "¸ıĞç", "ÈÉĞç"],
         ["ÒÒº¥","¶¡º¥", "¼ºº¥", "ĞÁº¥", "¹ïº¥"]
]

def ComputeTimeGan(bazi,hour):
    dayGan = bazi[4]
    for i in range(0,10):
        if dayGan == TianGan[i]:
            break
    if i>10 or i==0:
        return 0
    indexX = i
    if indexX > 5 or indexX==5:
        indexX = indexX -5
    indexY = int((hour+1)/2)

    return bazi+cTimeGanZhi_Table[indexY][indexX]

#Ê®¶şÔÂ·İÌì¸ÉÇ¿¶È±í
#ÉúÔÂ\ËÄÖùÌì¸É        ¼×              ÒÒ              ±û              ¶¡              Îì              ¼º              ¸ı              ĞÁ              ÈÉ              ¹ï
# ×ÓÔÂ                            1.2             1.2             1.0             1.0             1.0             1.0             1.0             1.0             1.2             1.2
# ³óÔÂ                            1.06 1.06 1.0             1.0             1.1             1.1             1.14 1.14 1.1             1.1
# ÒúÔÂ                            1.14 1.14 1.2             1.2             1.06 1.06 1.0             1.0             1.0             1.0
# Ã®ÔÂ                            1.2             1.2             1.2             1.2             1.0             1.0             1.0             1.0             1.0             1.0
# ³½ÔÂ                            1.1             1.1             1.06 1.06 1.1             1.1             1.1             1.1             1.04 1.04
# ËÈÔÂ                            1.0             1.0             1.14 1.14 1.14 1.14 1.06 1.06 1.06 1.06
# ÎçÔÂ                            1.0             1.0             1.2             1.2             1.2             1.2             1.0             1.0             1.0             1.0
# Î´ÔÂ                            1.04 1.04 1.1             1.1             1.16 1.16 1.1             1.1             1.0             1.0
# ÉêÔÂ                            1.06 1.06 1.0             1.0             1.0             1.0             1.14 1.14 1.2             1.2
# ÓÏÔÂ                            1.0             1.0             1.0             1.0             1.0             1.0             1.2             1.2             1.2             1.2
# ĞçÔÂ                            1.0             1.0             1.04 1.04 1.14 1.14 1.16 1.16 1.06 1.06
# º¥ÔÂ                            1.2             1.2             1.0             1.0             1.0             1.0             1.0             1.0             1.14 1.14
TianGan_Strength = [
    [1.2, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.2, 1.2],
    [1.06, 1.06, 1.0, 1.0, 1.1, 1.1, 1.14, 1.14, 1.1, 1.1],
    [1.14, 1.14, 1.2, 1.2, 1.06, 1.06, 1.0, 1.0, 1.0, 1.0],
    [1.2, 1.2, 1.2, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0],
    [1.1, 1.1, 1.06, 1.06, 1.1, 1.1, 1.1, 1.1, 1.04, 1.04],
    [1.0, 1.0, 1.14, 1.14, 1.14, 1.14, 1.06, 1.06, 1.06, 1.06],
    [1.0, 1.0, 1.2, 1.2, 1.2, 1.2, 1.0, 1.0, 1.0, 1.0],
    [1.04, 1.04, 1.1, 1.1, 1.16, 1.16, 1.1, 1.1, 1.0, 1.0],
    [1.06, 1.06, 1.0, 1.0, 1.0, 1.0, 1.14, 1.14, 1.2, 1.2],
    [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.2, 1.2, 1.2, 1.2],
    [1.0, 1.0, 1.04, 1.04, 1.14, 1.14, 1.16, 1.16, 1.06, 1.06],
    [1.2, 1.2, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.14, 1.14]
]

#Ê®¶şÔÂ·İµØÖ§Ç¿¶È±í
#µØÖ§         Ö§²Ø       ×ÓÔÂ         ³óÔÂ         ÒúÔÂ         Ã®ÔÂ         ³½ÔÂ         ËÈÔÂ         ÎçÔÂ         Î´ÔÂ         ÉêÔÂ         ÓÏÔÂ         ĞçÔÂ         º¥ÔÂ
# ×Ó              ¹ï                       1.2             1.1             1.0             1.0             1.04 1.06 1.0             1.0             1.2             1.2             1.06 1.14
# ³ó              ¹ï                       0.36 0.33 0.3             0.3             0.312        0.318        0.3             0.3             0.36 0.36 0.318        0.342
# ³ó              ĞÁ                       0.2             0.228        0.2             0.2             0.23 0.212        0.2             0.22 0.228        0.248        0.232        0.2
# ³ó              ¼º                       0.5             0.55 0.53 0.5             0.55 0.57 0.6             0.58 0.5             0.5             0.57 0.5
# Òú              ±û                       0.3             0.3             0.36 0.36 0.318        0.342        0.36 0.33 0.3             0.3             0.342        0.318
# Òú              ¼×                       0.84 0.742        0.798        0.84 0.77 0.7             0.7             0.728        0.742        0.7             0.7             0.84
# Ã®              ÒÒ                       1.2             1.06 1.14 1.2             1.1             1.0             1.0             1.04 1.06 1.0             1.0             1.2
# ³½              ÒÒ                       0.36 0.318        0.342        0.36 0.33 0.3             0.3             0.312        0.318        0.3             0.3             0.36
# ³½              ¹ï                       0.24 0.22 0.2             0.2             0.208        0.2             0.2             0.2             0.24 0.24 0.212        0.228
# ³½              Îì                       0.5             0.55 0.53 0.5             0.55 0.6             0.6             0.58 0.5             0.5             0.57 0.5
# ËÈ              ¸ı                       0.3             0.342        0.3             0.3             0.33 0.3             0.3             0.33 0.342        0.36 0.348        0.3
# ËÈ              ±û                       0.7             0.7             0.84 0.84 0.742        0.84 0.84 0.798        0.7             0.7             0.728        0.742
# Îç              ¶¡                       1.0             1.0             1.2             1.2             1.06 1.14 1.2             1.1             1.0             1.0             1.04 1.06
# Î´              ¶¡                       0.3             0.3             0.36 0.36 0.318        0.342        0.36 0.33 0.3             0.3             0.312        0.318
# Î´              ÒÒ                       0.24 0.212        0.228        0.24 0.22 0.2             0.2             0.208        0.212        0.2             0.2             0.24
# Î´              ¼º                       0.5             0.55 0.53 0.5             0.55 0.57 0.6             0.58 0.5             0.5             0.57 0.5
# Éê              ÈÉ                       0.36 0.33 0.3             0.3             0.312        0.318        0.3             0.3             0.36 0.36 0.318        0.342
# Éê              ¸ı                       0.7             0.798        0.7             0.7             0.77 0.742        0.7             0.77 0.798        0.84 0.812        0.7
# ÓÏ              ĞÁ                       1.0             1.14 1.0             1.0             1.1             1.06 1.0             1.1             1.14 1.2             1.16 1.0
# Ğç              ĞÁ                       0.3             0.342        0.3             0.3             0.33 0.318        0.3             0.33 0.342        0.36 0.348        0.3
# Ğç              ¶¡                       0.2             0.2             0.24 0.24 0.212        0.228        0.24 0.22 0.2             0.2             0.208        0.212
# Ğç              Îì                       0.5             0.55 0.53 0.5             0.55 0.57 0.6             0.58 0.5             0.5             0.57 0.5
# º¥              ¼×                       0.36 0.318        0.342        0.36 0.33 0.3             0.3             0.312        0.318        0.3             0.3             0.36
# º¥              ÈÉ                        0.84 0.77 0.7             0.7             0.728        0.742        0.7             0.7             0.84 0.84 0.724        0.798
DiZhi_Strength = [
    ['×Ó', '¹ï', [1.2,1.1, 1.0, 1.0,        1.04, 1.06, 1.0,1.0, 1.2, 1.2, 1.06, 1.14]],
         ['³ó', '¹ï', [0.36,0.33, 0.3, 0.3, 0.312, 0.318, 0.3, 0.3, 0.36, 0.36, 0.318, 0.342]],
         ['³ó', 'ĞÁ', [0.2,0.228, 0.2, 0.2, 0.23, 0.212, 0.2,         0.22,0.228, 0.248, 0.232, 0.2]],
         ['³ó', '¼º', [0.5,0.55, 0.53, 0.5, 0.55, 0.57, 0.6, 0.58, 0.5, 0.5, 0.57, 0.5]],
         ['Òú', '±û', [0.3,0.3, 0.36, 0.36, 0.318, 0.342, 0.36, 0.33, 0.3, 0.3, 0.342, 0.318]],
         ['Òú', '¼×', [0.84,0.742, 0.798, 0.84, 0.77, 0.7, 0.7, 0.728, 0.742, 0.7, 0.7, 0.84]],
         ['Ã®', 'ÒÒ', [1.2,1.06, 1.14, 1.2, 1.1, 1.0, 1.0, 1.04, 1.06, 1.0, 1.0, 1.2]],
         ['³½', 'ÒÒ', [0.36,0.318, 0.342, 0.36, 0.33, 0.3, 0.3, 0.312, 0.318, 0.3, 0.3, 0.36]],
         ['³½', '¹ï', [0.24,0.22,  0.2, 0.2, 0.208, 0.2, 0.2, 0.2,0.24, 0.24, 0.212, 0.228]],
         ['³½', 'Îì', [0.5,0.55, 0.53, 0.5, 0.55, 0.6, 0.6, 0.58, 0.5, 0.5, 0.57, 0.5]],
         ['ËÈ', '¸ı', [0.3,0.342, 0.3, 0.3, 0.33, 0.3, 0.3, 0.33, 0.342, 0.36, 0.348, 0.3]],
         ['ËÈ', '±û', [0.7,0.7, 0.84, 0.84, 0.742, 0.84, 0.84, 0.798, 0.7, 0.7, 0.728, 0.742]],
         ['Îç', '¶¡', [1.0,1.0, 1.2, 1.2, 1.06, 1.14, 1.2, 1.1, 1.0, 1.0, 1.04, 1.06]],
         ['Î´', '¶¡', [0.3,0.3, 0.36, 0.36, 0.318, 0.342, 0.36, 0.33, 0.3, 0.3, 0.312, 0.318]],
         ['Î´', 'ÒÒ', [0.24,0.212, 0.228, 0.24, 0.22, 0.2, 0.2, 0.208, 0.212, 0.2, 0.2, 0.24]],
         ['Î´', '¼º', [0.5,0.55, 0.53, 0.5, 0.55, 0.57, 0.6, 0.58, 0.5, 0.5, 0.57, 0.5]],
         ['Éê', 'ÈÉ', [0.36,0.33, 0.3, 0.3, 0.312, 0.318, 0.3, 0.3, 0.36, 0.36, 0.318, 0.342]],
         ['Éê', '¸ı', [0.7,0.798, 0.7, 0.7, 0.77, 0.742, 0.7, 0.77, 0.798, 0.84, 0.812, 0.7]],
         ['ÓÏ', 'ĞÁ', [1.0,1.14, 1.0, 1.0, 1.1, 1.06, 1.0, 1.1, 1.14, 1.2, 1.16, 1.0]],
         ['Ğç', 'ĞÁ', [0.3,0.342, 0.3, 0.3, 0.33, 0.318, 0.3, 0.33, 0.342, 0.36, 0.348, 0.3]],
         ['Ğç', '¶¡', [0.2,0.2, 0.24, 0.24, 0.212, 0.228, 0.24, 0.22, 0.2, 0.2, 0.208, 0.212]],
         ['Ğç', 'Îì', [0.5,0.55, 0.53, 0.5, 0.55, 0.57, 0.6, 0.58, 0.5, 0.5, 0.57, 0.5]],
         ['º¥', '¼×', [0.36,0.318, 0.342, 0.36, 0.33, 0.3, 0.3, 0.312, 0.318, 0.3, 0.3, 0.36]],
         ['º¥', 'ÈÉ', [0.84,0.77, 0.7, 0.7, 0.728, 0.742, 0.7, 0.7, 0.84, 0.84, 0.724, 0.798]]
]

WuXingTable = ['½ğ', 'Ä¾', 'Ë®', '»ğ', 'ÍÁ']

#Ìì¸ÉµØÖ§µÄÎåĞĞÊôĞÔ±í
#Ìì¸É£º ¼×-Ä¾¡¢ÒÒ-Ä¾¡¢±û-»ğ¡¢¶¡£­»ğ¡¢Îì£­ÍÁ¡¢¼º£­ÍÁ¡¢¸ı£­½ğ¡¢ĞÁ£­½ğ¡¢ÈÉ£­Ë®¡¢¹ï£­Ë®
#µØÖ§£º×Ó-Ë®¡¢³ó-ÍÁ¡¢Òú-Ä¾¡¢Ã®£­Ä¾¡¢³½£­ÍÁ¡¢ËÈ£­»ğ¡¢Îç£­»ğ¡¢Î´£­ÍÁ¡¢Éê£­½ğ¡¢ÓÏ£­½ğ¡¢Ğç£­ÍÁ¡¢º¥£­Ë®

TianGan_WuXingProp = [1, 1, 3, 3, 4,4, 0, 0, 2, 2]
DiZhi_WuXingProp = [2, 4, 1, 1, 4,3, 3, 4, 0, 0, 4, 2]
GenerationSourceTable = [4, 2, 0, 1,3]

def ComputeGanIndex(gan):
    for i in range(0,10):
        if TianGan[i] == gan:
            break
    if i>10 or i==10:
        return -1
    return i

def ComputeZhiIndex(zhi):
    for i in range(0,12):
        if DiZhi[i] == zhi:
            break
    if i > 12 or i==12:
        return -1
    return i

def EvalBaziScore(bazi):
    strengthResult = [0.0,0.0,0.0,0.0,0.0]
    wxCount = [0, 0, 0, 0, 0]
    monthIndex = ComputeZhiIndex(bazi[3])
    if monthIndex == -1:
        return 0
    for wuXing in range(0,5):
        value1 = 0.0
        value2 = 0.0
        i = 0
        while i<8:
            gan = bazi[i]
            index = ComputeGanIndex(gan)
            if index == -1:
                return 0
            if TianGan_WuXingProp[index] == wuXing:
                value1 = value1 + TianGan_Strength[monthIndex][index]
            i = i + 2
        i = 0
        while i < 8:
            zhi = bazi[i]
            for j in range(0,len(DiZhi_Strength)):
                if DiZhi_Strength[j][0] == zhi:
                    zhiCangIndex = ComputeGanIndex(DiZhi_Strength[j][1])
                    if zhiCangIndex == -1:
                        return 0
                    if TianGan_WuXingProp[zhiCangIndex] == wuXing:
                        value2 += DiZhi_Strength[j][2][monthIndex]
                        break
            i = i+2

        strengthResult[wuXing]= value1 + value2
    return "%.3f,%.3f,%.3f,%.3f,%.3f" % (strengthResult[0],strengthResult[1],strengthResult[2],strengthResult[3],strengthResult[4])

